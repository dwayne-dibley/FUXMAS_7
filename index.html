<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>FUXMAS 7, 2025 — Private Supabase Slideshow</title>

<!-- Correct Supabase browser SDK -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
  :root{
    --bg:#0f1115;
    --card:#0f1720;
    --text:#e6eef8;
    --muted:#9fb0c8;
    --accent:#ffca28;
  }
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:var(--text);margin:0;padding:20px;line-height:1.35}
  .container{max-width:1100px;margin:0 auto}
  .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:18px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.6);margin-bottom:18px}
  h1{margin:0 0 8px;font-size:1.5rem}
  .meta{color:var(--muted);font-size:0.9rem;margin-bottom:12px}
  table.schedule{width:100%;border-collapse:collapse;font-size:0.95rem}
  table.schedule th, table.schedule td{padding:8px 10px;border-bottom:1px dashed rgba(255,255,255,0.03);text-align:left}
  table.schedule th{background:rgba(255,255,255,0.02);font-weight:600;color:var(--muted)}
  a{color:var(--accent);text-decoration:none}
  a:hover{text-decoration:underline}

  .slideshow{display:flex;gap:18px;align-items:center;flex-wrap:wrap}
  .viewer{flex:1 1 600px;height:480px;background:#081018;border-radius:8px;display:flex;align-items:center;justify-content:center;overflow:hidden;position:relative}
  .viewer img{max-width:100%;max-height:100%;object-fit:contain;display:block}
  .controls{display:flex;flex-direction:column;gap:8px;min-width:230px}
  .btn{padding:10px 12px;border-radius:8px;background:rgba(255,255,255,0.03);color:var(--text);border:1px solid rgba(255,255,255,0.03);cursor:pointer}
  .btn:hover{filter:brightness(1.05)}
  .row{display:flex;gap:8px}
  .note{font-size:0.85rem;color:var(--muted);margin-top:8px}
  input[type=file]{display:none}
</style>
</head>
<body>
  <div class="container">

    <!-- Title & Empty Table -->
    <div class="card">
      <h1>FUXMAS 7, 2025</h1>

      <table class="schedule">
        <thead>
          <tr><th>TIME</th><th>PINT</th><th>LOCATION</th><th>NOTES</th><th>WALKING</th><th>OTHER</th></tr>
<tr><td>11:00</td><td>1</td>    <td><a href="https://www.google.com/maps/place/The+Reveley/@-31.9519534,115.8408041,14z/data=!3m1!5s0x2a32bb2a2b1cb247:0xa92dfef6a19e60b4!4m10!1m3!11m2!2sU3UmzSaCRyyn_0DuMe_RCg!3e3!3m5!1s0x2a32bb2a2dc5896d:0xc7d718e0609efc2a!8m2!3d-31.9583975!4d115.8574947!16s%2Fg%2F11byx8pl07?authuser=0&entry=ttu&g_ep=EgoyMDI1MTEwNC4xIKXMDSoASAFQAw%3D%3D">The Reveley</a></td>                                       <td>FUXMAS 2</td>                           <td></td>               <td></td>       </tr>
        </thead>
        <tbody>
          <tr><td colspan="7" style="text-align:center;color:var(--muted)">NO SPOILERS!!! All will be revealed in due course</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Slideshow & Upload -->
    <div class="card">
      <h2>Private Slideshow</h2>
      <p class="meta">Images stored privately in Supabase bucket <code>fuxmas-images</code>.</p>

      <div class="slideshow">
        <div class="viewer" id="viewer">
          <div id="placeholder" style="color:var(--muted);padding:12px">No images uploaded yet.</div>
          <img id="slideImg" src="" alt="" style="display:none" />
        </div>

        <div class="controls">
          <div class="row">
            <button class="btn" id="prevBtn">⟨ Prev</button>
            <button class="btn" id="playPauseBtn">Pause</button>
            <button class="btn" id="nextBtn">Next ⟩</button>
          </div>

          <div class="row">
            <button class="btn" id="reloadBtn">Reload images</button>
            <button class="btn" id="uploadBtn">Upload Image(s)</button>
          </div>

          <div class="meta" id="imageCounter">0 images</div>

          <input id="fileInput" type="file" accept="image/png,image/jpeg" multiple />
          <div class="note">Max file size: 20 MB. JPG or PNG only.</div>
        </div>
      </div>

    </div>

  </div>

<!-- FULL WORKING JAVASCRIPT -->
<script>
document.addEventListener("DOMContentLoaded", () => {

  // --- Supabase Setup ---
  const SUPABASE_URL = "https://dmqgpcsubaegmdaptici.supabase.co";
  const SUPABASE_ANON_KEY =
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRtcWdwY3N1YmFlZ21kYXB0aWNpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjM5ODM2OTIsImV4cCI6MjA3OTU1OTY5Mn0.dMbp4f1xBxrBAc1Coh7FV1fTBjiSG3yfBcRerUCS6ko";

  const { createClient } = window.supabase;
  const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  const BUCKET = "fuxmas-images";
  const SIGNED_URL_EXPIRES = 3600;
  const REFRESH_MS = 30000;
  const SLIDE_MS = 10000;

  // --- Elements ---
  const slideImg = document.getElementById("slideImg");
  const placeholder = document.getElementById("placeholder");
  const imageCounter = document.getElementById("imageCounter");
  const uploadBtn = document.getElementById("uploadBtn");
  const fileInput = document.getElementById("fileInput");
  const nextBtn = document.getElementById("nextBtn");
  const prevBtn = document.getElementById("prevBtn");
  const playPauseBtn = document.getElementById("playPauseBtn");
  const reloadBtn = document.getElementById("reloadBtn");

  let images = [];
  let current = 0;
  let playing = true;

  function showPlaceholder() {
    placeholder.style.display = "block";
    slideImg.style.display = "none";
    imageCounter.textContent = "0 images";
  }

  function showImage(idx) {
    if (images.length === 0) { showPlaceholder(); return; }
    current = (idx + images.length) % images.length;
    slideImg.src = images[current].signedUrl;
    slideImg.style.display = "block";
    placeholder.style.display = "none";
    imageCounter.textContent = `${current+1} / ${images.length}`;
  }

  async function refreshImages() {
    const { data, error } = await supabaseClient.storage
      .from(BUCKET)
      .list("", { limit: 500 });

    if (error || !data) { images = []; showPlaceholder(); return; }

    const files = data.filter(f => /\.(png|jpe?g)$/i.test(f.name));
    const signed = await Promise.all(
      files.map(async f => {
        const { data: signedData, error: signErr } =
          await supabaseClient.storage.from(BUCKET)
            .createSignedUrl(f.name, SIGNED_URL_EXPIRES);
        if (signErr) return null;
        return { name: f.name, signedUrl: signedData.signedUrl };
      })
    );

    images = signed.filter(Boolean);
    if (images.length === 0) showPlaceholder();
    else showImage(current);
  }

  async function uploadFiles(files){
    for (const file of files) {
      if (file.size > 20*1024*1024) { alert("Too large (20 MB max)"); continue; }

      const safeName = `${Date.now()}__${file.name.replace(/\s+/g,"_")}`;
      const { error } = await supabaseClient.storage
        .from(BUCKET)
        .upload(safeName, file);

      if (error) alert("Upload failed: " + error.message);
    }
    await refreshImages();
  }

  // --- Controls ---
  nextBtn.addEventListener("click", () => showImage(current+1));
  prevBtn.addEventListener("click", () => showImage(current-1));

  playPauseBtn.addEventListener("click", () => {
    playing = !playing;
    playPauseBtn.textContent = playing ? "Pause" : "Play";
  });

  reloadBtn.addEventListener("click", refreshImages);

  // Upload
  uploadBtn.addEventListener("click", () => fileInput.click());
  fileInput.addEventListener("change", async e => {
    const files = [...e.target.files]
      .filter(f => /\.(png|jpe?g)$/i.test(f.name));
    if (!files.length) { alert("Only JPG/PNG allowed"); return; }
    await uploadFiles(files);
    e.target.value = "";
  });

  // --- Initial Load ---
  showPlaceholder();
  refreshImages();

  // Auto-refresh image list
  setInterval(refreshImages, REFRESH_MS);

  // Auto-advance slideshow
  setInterval(() => { if (playing) showImage(current+1); }, SLIDE_MS);

});
</script>

</body>
</html>
